<!DOCTYPE html>
<html lang="he">
<head>
  <meta charset="UTF-8">
  <title>A-Impact Licensing Assistant</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <h1>××¢×¨×›×ª ×”×¢×¨×›×ª ×¨×™×©×•×™ ×¢×¡×§×™×</h1>
  <form id="pipelineForm">

    <!-- Basic Info -->
    <label>×©× ×”×¢×¡×§: <input type="text" id="business_name" required></label>
    <label>×©×˜×— (×"×¨): <input type="number" id="area_sqm" required></label>
    <label>××¡×¤×¨ ××§×•××•×ª ×™×©×™×‘×”: <input type="number" id="num_seats" required></label>

    <!-- Food & Kitchen -->
    <label>××’×™×© ×‘×©×¨:
      <select id="has_meat">
        <option value="false">×œ×</option>
        <option value="true">×›×Ÿ</option>
      </select>
    </label>
    <label>××’×™×© ×—×œ×‘×™:
      <select id="serves_dairy">
        <option value="false">×œ×</option>
        <option value="true">×›×Ÿ</option>
      </select>
    </label>
    <label>×›×©×¨:
      <select id="is_kosher">
        <option value="false">×œ×</option>
        <option value="true">×›×Ÿ</option>
      </select>
    </label>
    <label>×©×™××•×© ×‘×’×–:
      <select id="uses_gas">
        <option value="false">×œ×</option>
        <option value="true">×›×Ÿ</option>
      </select>
    </label>
    <label>×˜×™×’×•×Ÿ (×¦'×™×¤×¡×¨):
      <select id="uses_fryer">
        <option value="false">×œ×</option>
        <option value="true">×›×Ÿ</option>
      </select>
    </label>
    <label>×’×¨×™×œ ×’×– / ××© ×¤×ª×•×—×”:
      <select id="uses_gas_grill">
        <option value="false">×œ×</option>
        <option value="true">×›×Ÿ</option>
      </select>
    </label>

    <!-- Services -->
    <label>××©×œ×•×—×™×:
      <select id="delivers">
        <option value="false">×œ×</option>
        <option value="true">×›×Ÿ</option>
      </select>
    </label>

    <!-- Beverages -->
    <label>××’×™×© ××œ×›×•×”×•×œ:
      <select id="has_alcohol">
        <option value="false">×œ×</option>
        <option value="true">×›×Ÿ</option>
      </select>
    </label>

    <!-- Seating & Location -->
    <label>×™×©×™×‘×” ×‘××§×•×:
      <select id="has_seating">
        <option value="true">×›×Ÿ</option>
        <option value="false">×œ×</option>
      </select>
    </label>
    <label>×¢×¡×§ ×¤×ª×•×— ×œ×’××¨×™ (open-air):
      <select id="is_open_air">
        <option value="false">×œ×</option>
        <option value="true">×›×Ÿ</option>
      </select>
    </label>

    <button type="submit">×”×¨×¥ ×¤×™×™×¤×œ×™×™×Ÿ</button>
  </form>

  <div id="result"></div>

  <script>
    document.getElementById("pipelineForm").addEventListener("submit", async (e) => {
      e.preventDefault();

      const button = e.target.querySelector("button");
      button.disabled = true;
      button.textContent = "××¨×™×¥...";

      // ×”×ª×××” ××œ××” ×œ-BusinessProfile
      const profile = {
        business_name: document.getElementById("business_name").value,
        area_sqm: parseInt(document.getElementById("area_sqm").value),
        num_seats: parseInt(document.getElementById("num_seats").value),
        has_meat: document.getElementById("has_meat").value === "true",
        serves_dairy: document.getElementById("serves_dairy").value === "true",
        is_kosher: document.getElementById("is_kosher").value === "true",
        uses_gas: document.getElementById("uses_gas").value === "true",
        uses_fryer: document.getElementById("uses_fryer").value === "true",
        uses_gas_grill: document.getElementById("uses_gas_grill").value === "true",
        delivers: document.getElementById("delivers").value === "true",
        has_alcohol: document.getElementById("has_alcohol").value === "true",
        has_seating: document.getElementById("has_seating").value === "true",
        is_open_air: document.getElementById("is_open_air").value === "true"
      };

      const payload = {
        profile: profile,
        source_doc_path: "data/rew/18-07-2022_4.2A.pdf",
        output_dir: "output/"
      };

      console.log("ğŸ“¤ Payload ×©× ×©×œ×— ×œ-Backend:", payload);

      try {
        const response = await fetch("http://127.0.0.1:8000/api/v1/pipeline/run_json", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });

      const data = await response.json();
      document.getElementById("result").innerHTML =
        data.status === "success"
          ? `<h2>âœ… ×“×•×— × ×•×¦×¨ ×‘×”×¦×œ×—×”</h2><pre style="white-space: pre-wrap; text-align:right;">${data.report_text}</pre>`
          : `<p style="color:red;">âŒ ×©×’×™××”: ${data.detail || JSON.stringify(data)}</p>`;
      } catch (err) {
        document.getElementById("result").innerText = "âš ï¸ ×©×’×™××” ×‘×—×™×‘×•×¨ ×œ×©×¨×ª: " + err;
      } finally {
        button.disabled = false;
        button.textContent = "×”×¨×¥ ×¤×™×™×¤×œ×™×™×Ÿ";
      }
    });
  </script>
</body>
</html>
